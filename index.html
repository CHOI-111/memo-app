<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ëª¨ì¥ ì•±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            500: '#667eea',
                            600: '#5568d3',
                            700: '#4c63d2',
                        },
                        secondary: {
                            500: '#764ba2',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 p-5">
    <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ -->
    <div id="authScreen" class="max-w-md mx-auto mt-20">
        <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-8 shadow-xl">
            <h2 class="text-3xl font-bold text-center mb-8 bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                ë©”ëª¨ì¥
            </h2>
            
            <!-- ë¡œê·¸ì¸ í¼ -->
            <div id="loginForm">
                <h3 class="text-2xl font-semibold text-gray-800 mb-6 text-center">ë¡œê·¸ì¸</h3>
                <div class="space-y-4">
                    <div>
                        <input 
                            type="text" 
                            id="loginUsername"
                            placeholder="ì‚¬ìš©ìëª… ë˜ëŠ” ì´ë©”ì¼"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all duration-200"
                        />
                    </div>
                    <div>
                        <input 
                            type="password" 
                            id="loginPassword"
                            placeholder="ë¹„ë°€ë²ˆí˜¸"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all duration-200"
                        />
                    </div>
                    <div id="loginError" class="text-red-500 text-sm hidden"></div>
                    <button 
                        id="loginBtn"
                        class="w-full px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all duration-200"
                    >
                        ë¡œê·¸ì¸
                    </button>
                    <p class="text-center text-gray-600">
                        ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? 
                        <button id="showRegisterBtn" class="text-indigo-600 hover:text-indigo-700 font-semibold">
                            íšŒì›ê°€ì…
                        </button>
                    </p>
                </div>
            </div>

            <!-- íšŒì›ê°€ì… í¼ -->
            <div id="registerForm" class="hidden">
                <h3 class="text-2xl font-semibold text-gray-800 mb-6 text-center">íšŒì›ê°€ì…</h3>
                <div class="space-y-4">
                    <div>
                        <input 
                            type="text" 
                            id="registerUsername"
                            placeholder="ì‚¬ìš©ìëª…"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all duration-200"
                        />
                    </div>
                    <div>
                        <input 
                            type="email" 
                            id="registerEmail"
                            placeholder="ì´ë©”ì¼"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all duration-200"
                        />
                    </div>
                    <div>
                        <input 
                            type="password" 
                            id="registerPassword"
                            placeholder="ë¹„ë°€ë²ˆí˜¸ (ìµœì†Œ 6ì)"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all duration-200"
                        />
                    </div>
                    <div id="registerError" class="text-red-500 text-sm hidden"></div>
                    <button 
                        id="registerBtn"
                        class="w-full px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all duration-200"
                    >
                        íšŒì›ê°€ì…
                    </button>
                    <p class="text-center text-gray-600">
                        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? 
                        <button id="showLoginBtn" class="text-indigo-600 hover:text-indigo-700 font-semibold">
                            ë¡œê·¸ì¸
                        </button>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- ë©”ëª¨ì¥ ë©”ì¸ í™”ë©´ -->
    <div id="memoScreen" class="max-w-4xl mx-auto hidden">
        <header class="flex justify-between items-center mb-8 bg-white/95 backdrop-blur-sm rounded-2xl px-8 py-6 shadow-xl">
            <div>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                    ë©”ëª¨ì¥
                </h1>
                <p class="text-sm text-gray-600 mt-1" id="userInfo">ì•ˆë…•í•˜ì„¸ìš”, <span id="usernameDisplay"></span>ë‹˜!</p>
            </div>
            <div class="flex gap-3 items-center">
                <button 
                    id="newMemoBtn" 
                    class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all duration-200"
                >
                    âœ¨ ìƒˆ ë©”ëª¨
                </button>
                <button 
                    id="logoutBtn"
                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-200"
                >
                    ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>
        </header>

        <div class="relative mb-6">
            <input 
                type="text" 
                id="searchInput"
                placeholder="ğŸ” ë©”ëª¨ ê²€ìƒ‰..."
                class="w-full px-5 py-4 pr-12 bg-white/95 backdrop-blur-sm rounded-xl shadow-lg focus:shadow-xl focus:ring-2 focus:ring-indigo-400 outline-none transition-all duration-200 text-gray-700 placeholder-gray-400"
            />
            <button 
                id="clearSearchBtn"
                class="absolute right-4 top-1/2 -translate-y-1/2 w-8 h-8 bg-gray-200 hover:bg-gray-300 rounded-full flex items-center justify-center text-gray-600 hover:scale-110 transition-all duration-200 hidden"
            >
                âœ•
            </button>
        </div>

        <div id="memosContainer" class="space-y-4">
            <div class="text-center py-16 px-8 bg-white/95 backdrop-blur-sm rounded-2xl shadow-lg text-gray-500 text-lg">
                ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ë©”ëª¨ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!
            </div>
        </div>
    </div>

    <!-- ê°œë°œì í˜ì´ì§€ ë²„íŠ¼ -->
    <div class="fixed bottom-4 right-4">
        <button 
            id="devPageBtn"
            class="px-3 py-1.5 text-xs bg-gray-600 hover:bg-gray-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 opacity-50 hover:opacity-100"
            title="ê°œë°œì í˜ì´ì§€"
        >
            ğŸ”§ ê°œë°œì
        </button>
    </div>

    <!-- ê°œë°œì í˜ì´ì§€ ëª¨ë‹¬ -->
    <div id="devModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">ê°œë°œì í˜ì´ì§€</h2>
                <button 
                    id="closeDevModal"
                    class="text-gray-500 hover:text-gray-700 text-2xl"
                >
                    âœ•
                </button>
            </div>

            <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í™”ë©´ -->
            <div id="devPasswordScreen">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                    <input 
                        type="password" 
                        id="devPassword"
                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none"
                    />
                    <div id="devPasswordError" class="text-red-500 text-sm mt-2 hidden"></div>
                </div>
                <button 
                    id="devPasswordBtn"
                    class="w-full px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg font-semibold transition-all duration-200"
                >
                    í™•ì¸
                </button>
            </div>

            <!-- ê°œë°œì í˜ì´ì§€ ë‚´ìš© -->
            <div id="devContent" class="hidden">
                <!-- ì‚¬ìš©ì ëª©ë¡ -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ì‚¬ìš©ì ëª©ë¡</h3>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div id="usersList" class="space-y-2">
                            <!-- ì‚¬ìš©ì ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>

                <!-- ë©”ëª¨ ëª©ë¡ -->
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ì „ì²´ ë©”ëª¨ ëª©ë¡</h3>
                    <div id="allMemosList" class="space-y-3">
                        <!-- ë©”ëª¨ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ê¸°ë°˜ ì‚¬ìš©ì ê´€ë¦¬ (ì„œë²„ ì—†ì´ ì‘ë™)
        let memos = [];
        let searchQuery = '';
        let currentUser = null;

        // ê°„ë‹¨í•œ ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ í•¨ìˆ˜ (ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì‚¬ìš©)
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // 32bit ì •ìˆ˜ë¡œ ë³€í™˜
            }
            return hash.toString();
        }

        // ì‚¬ìš©ì ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function getUsers() {
            const usersData = localStorage.getItem('app_users');
            return usersData ? JSON.parse(usersData) : [];
        }

        // ì‚¬ìš©ì ë°ì´í„° ì €ì¥
        function saveUsers(users) {
            localStorage.setItem('app_users', JSON.stringify(users));
        }

        // í˜„ì¬ ì‚¬ìš©ìì˜ ë©”ëª¨ ë¶ˆëŸ¬ì˜¤ê¸°
        function getUserMemos() {
            if (!currentUser) return [];
            const allMemos = JSON.parse(localStorage.getItem('app_memos') || '[]');
            return allMemos.filter(memo => memo.user_id === currentUser.id);
        }

        // í˜„ì¬ ì‚¬ìš©ìì˜ ë©”ëª¨ ì €ì¥
        function saveUserMemos(userMemos) {
            const allMemos = JSON.parse(localStorage.getItem('app_memos') || '[]');
            // í˜„ì¬ ì‚¬ìš©ìì˜ ë©”ëª¨ ì œê±°
            const otherMemos = allMemos.filter(memo => memo.user_id !== currentUser.id);
            // í˜„ì¬ ì‚¬ìš©ìì˜ ë©”ëª¨ ì¶”ê°€
            const updatedMemos = [...otherMemos, ...userMemos];
            localStorage.setItem('app_memos', JSON.stringify(updatedMemos));
        }

        // ë¡œê·¸ì¸
        function handleLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            const loginBtn = document.getElementById('loginBtn');

            if (!username || !password) {
                errorDiv.textContent = 'ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                errorDiv.classList.remove('hidden');
                return;
            }

            // ë²„íŠ¼ ë¹„í™œì„±í™”
            loginBtn.disabled = true;
            loginBtn.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
            errorDiv.classList.add('hidden');

            // ì•½ê°„ì˜ ì§€ì—°ìœ¼ë¡œ ë¡œë”© íš¨ê³¼
            setTimeout(() => {
                try {
                    const users = getUsers();
                    const hashedPassword = simpleHash(password);
                    
                    // ì‚¬ìš©ìëª… ë˜ëŠ” ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸ ê°€ëŠ¥
                    const user = users.find(u => 
                        (u.username === username || u.email === username) && 
                        u.password === hashedPassword
                    );

                    if (!user) {
                        errorDiv.textContent = 'ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                        errorDiv.classList.remove('hidden');
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'ë¡œê·¸ì¸';
                        return;
                    }

                    // ë¡œê·¸ì¸ ì„±ê³µ
                    currentUser = {
                        id: user.id,
                        username: user.username,
                        email: user.email
                    };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));

                    showMemoScreen();
                    loadMemos();
                } catch (error) {
                    console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                    errorDiv.textContent = 'ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    errorDiv.classList.remove('hidden');
                } finally {
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'ë¡œê·¸ì¸';
                }
            }, 300);
        }

        // íšŒì›ê°€ì…
        function handleRegister() {
            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const errorDiv = document.getElementById('registerError');
            const registerBtn = document.getElementById('registerBtn');

            if (!username || !email || !password) {
                errorDiv.textContent = 'ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                errorDiv.classList.remove('hidden');
                return;
            }

            if (password.length < 6) {
                errorDiv.textContent = 'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                errorDiv.classList.remove('hidden');
                return;
            }

            // ì´ë©”ì¼ í˜•ì‹ ê°„ë‹¨ ê²€ì¦
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                errorDiv.textContent = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                errorDiv.classList.remove('hidden');
                return;
            }

            // ë²„íŠ¼ ë¹„í™œì„±í™”
            registerBtn.disabled = true;
            registerBtn.textContent = 'íšŒì›ê°€ì… ì¤‘...';
            errorDiv.classList.add('hidden');

            // ì•½ê°„ì˜ ì§€ì—°ìœ¼ë¡œ ë¡œë”© íš¨ê³¼
            setTimeout(() => {
                try {
                    const users = getUsers();
                    
                    // ì¤‘ë³µ í™•ì¸
                    const existingUser = users.find(u => 
                        u.username === username || u.email === email
                    );

                    if (existingUser) {
                        errorDiv.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì‚¬ìš©ìëª… ë˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                        errorDiv.classList.remove('hidden');
                        registerBtn.disabled = false;
                        registerBtn.textContent = 'íšŒì›ê°€ì…';
                        return;
                    }

                    // ìƒˆ ì‚¬ìš©ì ìƒì„±
                    const newUser = {
                        id: Date.now(),
                        username: username,
                        email: email,
                        password: simpleHash(password), // ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ì €ì¥
                        created_at: new Date().toISOString()
                    };

                    users.push(newUser);
                    saveUsers(users);

                    // ìë™ ë¡œê·¸ì¸
                    currentUser = {
                        id: newUser.id,
                        username: newUser.username,
                        email: newUser.email
                    };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));

                    showMemoScreen();
                    loadMemos();
                } catch (error) {
                    console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
                    errorDiv.textContent = 'íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    errorDiv.classList.remove('hidden');
                } finally {
                    registerBtn.disabled = false;
                    registerBtn.textContent = 'íšŒì›ê°€ì…';
                }
            }, 300);
        }

        // ë¡œê·¸ì•„ì›ƒ
        function handleLogout() {
            currentUser = null;
            memos = [];
            localStorage.removeItem('currentUser');

            showAuthScreen();
        }

        // í™”ë©´ ì „í™˜
        function showAuthScreen() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('memoScreen').classList.add('hidden');
        }

        function showMemoScreen() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('memoScreen').classList.remove('hidden');
            if (currentUser) {
                document.getElementById('usernameDisplay').textContent = currentUser.username;
            }
        }

        // ë©”ëª¨ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadMemos() {
            if (!currentUser) {
                memos = [];
                renderMemos();
                return;
            }

            const userMemos = getUserMemos();
            memos = userMemos.map(memo => ({ ...memo, isEditing: false }));
            renderMemos();
        }

        // ìƒˆ ë©”ëª¨ ìƒì„±
        function handleNewMemo() {
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            const newMemo = {
                id: Date.now(),
                user_id: currentUser.id,
                title: '',
                content: '',
                isEditing: true,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };
            
            memos.unshift(newMemo);
            saveUserMemos(memos);
            renderMemos();

            setTimeout(() => {
                const titleInput = document.querySelector(`.memo-item[data-id="${newMemo.id}"] .memo-title-input`);
                if (titleInput) {
                    titleInput.focus();
                }
            }, 50);
        }

        // ë©”ëª¨ ìˆ˜ì • ëª¨ë“œ ì „í™˜
        function handleEdit(id) {
            memos = memos.map(memo => 
                memo.id === id 
                    ? { ...memo, isEditing: true } 
                    : { ...memo, isEditing: false }
            );
            renderMemos();
        }

        // ë©”ëª¨ ì €ì¥
        function handleSave(id) {
            const memoElement = document.querySelector(`.memo-item[data-id="${id}"]`);
            const titleInput = memoElement.querySelector('.memo-title-input');
            const contentInput = memoElement.querySelector('.memo-content-input');
            
            const title = titleInput.value.trim();
            const content = contentInput.value.trim();

            memos = memos.map(memo => {
                if (memo.id === id) {
                    return {
                        ...memo,
                        title,
                        content,
                        isEditing: false,
                        updated_at: new Date().toISOString()
                    };
                }
                return memo;
            });

            saveUserMemos(memos);
            renderMemos();
        }

        // ë©”ëª¨ ì·¨ì†Œ
        function handleCancel(id) {
            memos = memos.map(memo =>
                memo.id === id
                    ? { ...memo, isEditing: false }
                    : memo
            );
            renderMemos();
        }

        // ë©”ëª¨ ì‚­ì œ
        function handleDelete(id) {
            if (!confirm('ì •ë§ ì´ ë©”ëª¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            memos = memos.filter(memo => memo.id !== id);
            saveUserMemos(memos);
            renderMemos();
        }

        // ê²€ìƒ‰ í•„í„°ë§
        function filterMemos() {
            if (!searchQuery.trim()) {
                return memos;
            }
            const query = searchQuery.toLowerCase();
            return memos.filter(memo => {
                return (
                    (memo.title || '').toLowerCase().includes(query) ||
                    (memo.content || '').toLowerCase().includes(query)
                );
            });
        }

        // ë©”ëª¨ ë Œë”ë§
        function renderMemos() {
            const container = document.getElementById('memosContainer');
            const filteredMemos = filterMemos();

            if (filteredMemos.length === 0) {
                const emptyText = searchQuery 
                    ? 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.' 
                    : 'ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ë©”ëª¨ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!';
                container.innerHTML = `<div class="text-center py-16 px-8 bg-white/95 backdrop-blur-sm rounded-2xl shadow-lg text-gray-500 text-lg">${emptyText}</div>`;
                return;
            }

            container.innerHTML = filteredMemos.map(memo => {
                if (memo.isEditing) {
                    return `
                        <div class="memo-item bg-white/95 backdrop-blur-sm rounded-2xl p-6 shadow-xl border-2 border-indigo-300" data-id="${memo.id}">
                            <div class="flex flex-col gap-4">
                                <input
                                    type="text"
                                    class="memo-title-input px-4 py-3 border-2 border-gray-200 rounded-xl text-xl font-semibold focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all duration-200 text-gray-800"
                                    placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                    value="${(memo.title || '').replace(/"/g, '&quot;')}"
                                />
                                <textarea
                                    class="memo-content-input px-4 py-3 border-2 border-gray-200 rounded-xl text-base resize-y focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all duration-200 text-gray-700"
                                    placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                    rows="8"
                                >${(memo.content || '').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                                <div class="flex gap-3 justify-end">
                                    <button class="px-6 py-2.5 bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold rounded-xl shadow-md hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200" onclick="handleSave(${memo.id})">ğŸ’¾ ì €ì¥</button>
                                    <button class="px-6 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded-xl shadow-md hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200" onclick="handleCancel(${memo.id})">ì·¨ì†Œ</button>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    const title = memo.title || '';
                    const content = memo.content || '';
                    const titleDisplay = title || '<span class="text-gray-400 italic">ì œëª© ì—†ìŒ</span>';
                    const contentDisplay = content || '<div class="text-gray-400 italic mt-3">ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    
                    return `
                        <div class="memo-item bg-white/95 backdrop-blur-sm rounded-2xl p-6 shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-200" data-id="${memo.id}">
                            <div class="flex justify-between items-start mb-3 gap-4">
                                <h3 class="text-xl font-bold text-gray-800 flex-1 break-words">${titleDisplay}</h3>
                                <div class="flex gap-2 flex-shrink-0">
                                    <button class="px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white text-sm font-medium rounded-lg shadow-md hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200" onclick="handleEdit(${memo.id})">âœï¸ ìˆ˜ì •</button>
                                    <button class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-lg shadow-md hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200" onclick="handleDelete(${memo.id})">ğŸ—‘ï¸ ì‚­ì œ</button>
                                </div>
                            </div>
                            ${content ? `<div class="text-gray-600 leading-relaxed whitespace-pre-wrap break-words mt-3">${content.replace(/\n/g, '<br>')}</div>` : contentDisplay}
                        </div>
                    `;
                }
            }).join('');
        }

        // ê²€ìƒ‰ ì…ë ¥ ì²˜ë¦¬
        function handleSearch() {
            searchQuery = document.getElementById('searchInput').value;
            const clearBtn = document.getElementById('clearSearchBtn');
            if (searchQuery) {
                clearBtn.classList.remove('hidden');
                clearBtn.classList.add('flex');
            } else {
                clearBtn.classList.add('hidden');
                clearBtn.classList.remove('flex');
            }
            renderMemos();
        }

        // ê²€ìƒ‰ ì´ˆê¸°í™”
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            searchQuery = '';
            const clearBtn = document.getElementById('clearSearchBtn');
            clearBtn.classList.add('hidden');
            clearBtn.classList.remove('flex');
            renderMemos();
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.getElementById('loginBtn').addEventListener('click', handleLogin);
        document.getElementById('registerBtn').addEventListener('click', handleRegister);
        document.getElementById('logoutBtn').addEventListener('click', handleLogout);
        document.getElementById('showRegisterBtn').addEventListener('click', () => {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        });
        document.getElementById('showLoginBtn').addEventListener('click', () => {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        });
        document.getElementById('newMemoBtn').addEventListener('click', handleNewMemo);
        document.getElementById('searchInput').addEventListener('input', handleSearch);
        document.getElementById('clearSearchBtn').addEventListener('click', clearSearch);

        // Enter í‚¤ë¡œ ë¡œê·¸ì¸/íšŒì›ê°€ì…
        document.getElementById('loginPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleLogin();
        });
        document.getElementById('registerPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleRegister();
        });

        // ê°œë°œì í˜ì´ì§€ ì—´ê¸°
        function openDevPage() {
            document.getElementById('devModal').classList.remove('hidden');
            document.getElementById('devModal').classList.add('flex');
            document.getElementById('devPasswordScreen').classList.remove('hidden');
            document.getElementById('devContent').classList.add('hidden');
            document.getElementById('devPassword').value = '';
            document.getElementById('devPasswordError').classList.add('hidden');
        }

        // ê°œë°œì í˜ì´ì§€ ë‹«ê¸°
        function closeDevPage() {
            document.getElementById('devModal').classList.add('hidden');
            document.getElementById('devModal').classList.remove('flex');
        }

        // ê°œë°œì ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        function checkDevPassword() {
            const password = document.getElementById('devPassword').value;
            const errorDiv = document.getElementById('devPasswordError');

            if (password === '1234') {
                document.getElementById('devPasswordScreen').classList.add('hidden');
                document.getElementById('devContent').classList.remove('hidden');
                loadDevData();
            } else {
                errorDiv.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                errorDiv.classList.remove('hidden');
            }
        }

        // ê°œë°œì í˜ì´ì§€ ë°ì´í„° ë¡œë“œ
        function loadDevData() {
            // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
            const users = getUsers();
            const usersListDiv = document.getElementById('usersList');
            
            if (users.length === 0) {
                usersListDiv.innerHTML = '<p class="text-gray-500">ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                usersListDiv.innerHTML = users.map(user => `
                    <div class="bg-white p-3 rounded-lg border border-gray-200">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-semibold text-gray-800">${user.username}</p>
                                <p class="text-sm text-gray-600">${user.email}</p>
                                <p class="text-xs text-gray-400 mt-1">ê°€ì…ì¼: ${new Date(user.created_at).toLocaleString('ko-KR')}</p>
                            </div>
                            <span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded">ID: ${user.id}</span>
                        </div>
                    </div>
                `).join('');
            }

            // ì „ì²´ ë©”ëª¨ ëª©ë¡ ë¡œë“œ
            const allMemos = JSON.parse(localStorage.getItem('app_memos') || '[]');
            const memosListDiv = document.getElementById('allMemosList');
            
            if (allMemos.length === 0) {
                memosListDiv.innerHTML = '<p class="text-gray-500">ë“±ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                // ì‚¬ìš©ì ì •ë³´ì™€ í•¨ê»˜ í‘œì‹œ
                const memosWithUsers = allMemos.map(memo => {
                    const user = users.find(u => u.id === memo.user_id);
                    return {
                        ...memo,
                        username: user ? user.username : 'ì•Œ ìˆ˜ ì—†ìŒ',
                        userEmail: user ? user.email : 'ì•Œ ìˆ˜ ì—†ìŒ'
                    };
                });

                memosListDiv.innerHTML = memosWithUsers.map(memo => `
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <p class="font-semibold text-gray-800">${memo.title || '<span class="text-gray-400 italic">ì œëª© ì—†ìŒ</span>'}</p>
                                <p class="text-sm text-gray-600 mt-1">ì‘ì„±ì: ${memo.username} (${memo.userEmail})</p>
                            </div>
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">ID: ${memo.id}</span>
                        </div>
                        <div class="text-sm text-gray-700 mt-2 whitespace-pre-wrap break-words">
                            ${memo.content || '<span class="text-gray-400 italic">ë‚´ìš© ì—†ìŒ</span>'}
                        </div>
                        <div class="text-xs text-gray-400 mt-2">
                            ì‘ì„±ì¼: ${new Date(memo.created_at).toLocaleString('ko-KR')} | 
                            ìˆ˜ì •ì¼: ${new Date(memo.updated_at).toLocaleString('ko-KR')}
                        </div>
                    </div>
                `).join('');
            }
        }

        // ê°œë°œì í˜ì´ì§€ ì´ë²¤íŠ¸
        document.getElementById('devPageBtn').addEventListener('click', openDevPage);
        document.getElementById('closeDevModal').addEventListener('click', closeDevPage);
        document.getElementById('devPasswordBtn').addEventListener('click', checkDevPassword);
        document.getElementById('devPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkDevPassword();
            }
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('devModal').addEventListener('click', (e) => {
            if (e.target.id === 'devModal') {
                closeDevPage();
            }
        });

        // ì•± ì´ˆê¸°í™”
        const savedUser = localStorage.getItem('currentUser');
        
        if (savedUser) {
            try {
                currentUser = JSON.parse(savedUser);
                showMemoScreen();
                loadMemos();
            } catch (e) {
                localStorage.removeItem('currentUser');
                showAuthScreen();
            }
        } else {
            showAuthScreen();
        }
    </script>
</body>
</html>
